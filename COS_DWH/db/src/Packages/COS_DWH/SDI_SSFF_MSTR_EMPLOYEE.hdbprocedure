PROCEDURE "SDI_SSFF::MSTR_EMPLOYEE"() 
LANGUAGE SQLSCRIPT SQL SECURITY INVOKER
AS
BEGIN
STG_EMP_EMPLOYMENT_STG_EMP_EMPLOYMENT_OUTPUT_TAB = SELECT "endDate", "isContingentWorker", "isPrimary", "personIdExternal", "seniorityDate", "startDate", "userId" FROM "STG_EMP_EMPLOYMENT";
STG_EMP_JOB_STG_EMP_JOB_OUTPUT_TAB = SELECT "businessUnit", "company", "costCenter", "standardJobCode", "subDepartment", "department", "emplStatus", "employeeType", "employmentType", "endDate", "event", "eventReason", "holidayCalendarCode", "isFulltimeEmployee", "jobCode", "jobTitle", "location", "managerId", "position", "positionEntryDate", "regularTemp", "retired", "standardHours", "startDate", "userId", "workerCategory", "workingDaysPerWeek", "workscheduleCode", "division", "occupationPercent", "personalDivision" FROM "STG_EMP_JOB";
STG_MATRIX_MANAGER_STG_MATRIX_MANAGER_OUTPUT_TAB = SELECT "userId", "startDate", "endDate", "managerUserId" FROM "STG_MATRIX_MANAGER";
STG_PER_PERSON_STG_PER_PERSON_OUTPUT_TAB = SELECT "countryOfBirth", "personIdExternal", "dateOfBirth" FROM "STG_PER_PERSON";
STG_PER_PERSONAL_STG_PER_PERSONAL_OUTPUT_TAB = SELECT "startDate", "endDate", "firstName", "lastName", "gender", "personIdExternal" FROM "STG_PER_PERSONAL";
STG_USER_STG_USER_OUTPUT_TAB = SELECT "userId", "email", "employeeClass", "hireDate" FROM "STG_USER";
J_PERSON_PERSONAL_J_PERSON_PERSONAL_OUTPUT_TAB = SELECT "J_PERSON_PERSONAL_STG_PER_PERSON"."countryOfBirth" AS "countryOfBirth", "J_PERSON_PERSONAL_STG_PER_PERSON"."personIdExternal" AS "personIdExternal", "J_PERSON_PERSONAL_STG_PER_PERSON"."dateOfBirth" AS "dateOfBirth", "J_PERSON_PERSONAL_STG_PER_PERSONAL"."startDate" AS "startDate", "J_PERSON_PERSONAL_STG_PER_PERSONAL"."endDate" AS "endDate", "J_PERSON_PERSONAL_STG_PER_PERSONAL"."firstName" AS "firstName", "J_PERSON_PERSONAL_STG_PER_PERSONAL"."lastName" AS "lastName", "J_PERSON_PERSONAL_STG_PER_PERSONAL"."gender" AS "gender" FROM (:STG_PER_PERSON_STG_PER_PERSON_OUTPUT_TAB AS "J_PERSON_PERSONAL_STG_PER_PERSON" INNER JOIN :STG_PER_PERSONAL_STG_PER_PERSONAL_OUTPUT_TAB AS "J_PERSON_PERSONAL_STG_PER_PERSONAL" ON "J_PERSON_PERSONAL_STG_PER_PERSON"."personIdExternal" = "J_PERSON_PERSONAL_STG_PER_PERSONAL"."personIdExternal");
J_EMPLOYMENT_JOB_USER_J_EMPLOYMENT_JOB_USER_OUTPUT_TAB = SELECT "J_EMPLOYMENT_JOB_USER_STG_EMP_EMPLOYMENT"."endDate" AS "employmentEndDate", "J_EMPLOYMENT_JOB_USER_STG_EMP_EMPLOYMENT"."userId" AS "userId", "J_EMPLOYMENT_JOB_USER_STG_EMP_EMPLOYMENT"."isContingentWorker" AS "isContingentWorker", "J_EMPLOYMENT_JOB_USER_STG_EMP_EMPLOYMENT"."isPrimary" AS "isPrimary", "J_EMPLOYMENT_JOB_USER_STG_EMP_EMPLOYMENT"."personIdExternal" AS "personIdExternal", "J_EMPLOYMENT_JOB_USER_STG_EMP_EMPLOYMENT"."seniorityDate" AS "seniorityDate", "J_EMPLOYMENT_JOB_USER_STG_EMP_EMPLOYMENT"."startDate" AS "employmentStartDate", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."employeeType" AS "employeeType", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."employmentType" AS "employmentType", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."holidayCalendarCode" AS "holidayCalendarCode", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."jobCode" AS "jobCode", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."jobTitle" AS "jobTitle", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."managerId" AS "managerId", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."position" AS "position", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."positionEntryDate" AS "positionEntryDate", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."regularTemp" AS "regularTemp", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."workscheduleCode" AS "workscheduleCode", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."standardJobCode" AS "standardJobCode", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."subDepartment" AS "subDepartment", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."emplStatus" AS "emplStatus", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."event" AS "event", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."eventReason" AS "eventReason", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."location" AS "location", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."standardHours" AS "standardHours", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."userId" AS "userId_1", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."workingDaysPerWeek" AS "workingDaysPerWeek", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."division" AS "division", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."startDate" AS "startDate", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."isFulltimeEmployee" AS "isFulltimeEmployee", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."retired" AS "retired", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."workerCategory" AS "workerCategory", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."occupationPercent" AS "occupationPercent", "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."personalDivision" AS "personalDivision", "J_EMPLOYMENT_JOB_USER_STG_USER"."email" AS "email", "J_EMPLOYMENT_JOB_USER_STG_USER"."employeeClass" AS "employeeClass", "J_EMPLOYMENT_JOB_USER_STG_USER"."hireDate" AS "hireDate", "J_EMPLOYMENT_JOB_USER_STG_MATRIX_MANAGER"."managerUserId" AS "matrixManagerUserId" FROM (((:STG_EMP_JOB_STG_EMP_JOB_OUTPUT_TAB AS "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB" LEFT OUTER JOIN :STG_EMP_EMPLOYMENT_STG_EMP_EMPLOYMENT_OUTPUT_TAB AS "J_EMPLOYMENT_JOB_USER_STG_EMP_EMPLOYMENT" ON "J_EMPLOYMENT_JOB_USER_STG_EMP_EMPLOYMENT"."userId" = "J_EMPLOYMENT_JOB_USER_STG_EMP_JOB"."userId") LEFT OUTER JOIN :STG_USER_STG_USER_OUTPUT_TAB AS "J_EMPLOYMENT_JOB_USER_STG_USER" ON "J_EMPLOYMENT_JOB_USER_STG_EMP_EMPLOYMENT"."userId" = "J_EMPLOYMENT_JOB_USER_STG_USER"."userId") LEFT OUTER JOIN :STG_MATRIX_MANAGER_STG_MATRIX_MANAGER_OUTPUT_TAB AS "J_EMPLOYMENT_JOB_USER_STG_MATRIX_MANAGER" ON "J_EMPLOYMENT_JOB_USER_STG_EMP_EMPLOYMENT"."userId" = "J_EMPLOYMENT_JOB_USER_STG_MATRIX_MANAGER"."userId");
J_EMPLOYEE_J_EMPLOYEE_OUTPUT_TAB = SELECT "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."employmentEndDate" AS "employmentEndDate", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."employmentStartDate" AS "employmentStartDate", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."userId" AS "userId", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."employeeType" AS "employeeType", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."employmentType" AS "employmentType", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."holidayCalendarCode" AS "holidayCalendarCode", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."jobCode" AS "jobCode", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."jobTitle" AS "jobTitle", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."managerId" AS "managerId", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."position" AS "position", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."positionEntryDate" AS "positionEntryDate", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."regularTemp" AS "regularTemp", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."workscheduleCode" AS "workscheduleCode", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."email" AS "email", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."matrixManagerUserId" AS "matrixManagerUserId", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."employeeClass" AS "employeeClass", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."standardJobCode" AS "standardJobCode", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."subDepartment" AS "subDepartment", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."emplStatus" AS "emplStatus", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."event" AS "event", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."eventReason" AS "eventReason", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."location" AS "location", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."standardHours" AS "standardHours", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."workingDaysPerWeek" AS "workingDaysPerWeek", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."division" AS "division", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."isContingentWorker" AS "isContingentWorker", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."isPrimary" AS "isPrimary", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."personIdExternal" AS "personIdExternal", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."seniorityDate" AS "seniorityDate", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."startDate" AS "startDate", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."isFulltimeEmployee" AS "isFulltimeEmployee", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."retired" AS "retired", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."workerCategory" AS "workerCategory", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."occupationPercent" AS "occupationPercent", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."personalDivision" AS "personalDivision", "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."hireDate" AS "hireDate", "J_EMPLOYEE_J_PERSON_PERSONAL"."countryOfBirth" AS "countryOfBirth", "J_EMPLOYEE_J_PERSON_PERSONAL"."firstName" AS "firstName", "J_EMPLOYEE_J_PERSON_PERSONAL"."lastName" AS "lastName", "J_EMPLOYEE_J_PERSON_PERSONAL"."gender" AS "gender", "J_EMPLOYEE_J_PERSON_PERSONAL"."endDate" AS "endDate", "J_EMPLOYEE_J_PERSON_PERSONAL"."dateOfBirth" AS "dateOfBirth" FROM (:J_EMPLOYMENT_JOB_USER_J_EMPLOYMENT_JOB_USER_OUTPUT_TAB AS "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER" INNER JOIN :J_PERSON_PERSONAL_J_PERSON_PERSONAL_OUTPUT_TAB AS "J_EMPLOYEE_J_PERSON_PERSONAL" ON "J_EMPLOYEE_J_EMPLOYMENT_JOB_USER"."personIdExternal" = "J_EMPLOYEE_J_PERSON_PERSONAL"."personIdExternal");
F_DISTINCT_F_DISTINCT_OUTPUT_TAB=SELECT "countryOfBirth", "firstName", "lastName", "gender", "startDate", "endDate", "employmentEndDate", "F_DISTINCT_Input"."employmentStartDate" AS "employmentStartDate", "F_DISTINCT_Input"."userId" AS "userId", "F_DISTINCT_Input"."employeeType" AS "employeeType", "F_DISTINCT_Input"."employmentType" AS "employmentType", "F_DISTINCT_Input"."holidayCalendarCode" AS "holidayCalendarCode", "F_DISTINCT_Input"."jobCode" AS "jobCode", "F_DISTINCT_Input"."jobTitle" AS "jobTitle", null AS "managerId", "F_DISTINCT_Input"."position" AS "position", "F_DISTINCT_Input"."positionEntryDate" AS "positionEntryDate", "F_DISTINCT_Input"."regularTemp" AS "regularTemp", "workscheduleCode", "email", "matrixManagerUserId", "employeeClass", "standardJobCode", "subDepartment", "emplStatus", "F_DISTINCT_Input"."location" AS "location", "F_DISTINCT_Input"."standardHours" AS "standardHours", "F_DISTINCT_Input"."workingDaysPerWeek" AS "workingDaysPerWeek", "division", "F_DISTINCT_Input"."isPrimary" AS "isPrimary", "F_DISTINCT_Input"."isContingentWorker" AS "isContingentWorker", "F_DISTINCT_Input"."personIdExternal" AS "personIdExternal", "F_DISTINCT_Input"."seniorityDate" AS "seniorityDate", "isFulltimeEmployee", "retired", "workerCategory", "occupationPercent", "personalDivision", "hireDate" FROM :J_EMPLOYEE_J_EMPLOYEE_OUTPUT_TAB AS "F_DISTINCT_Input";
AGG_LATEST_AGG_LATEST_OUTPUT_TAB=SELECT "userId", MAX("startDate") AS "startDate" FROM :F_DISTINCT_F_DISTINCT_OUTPUT_TAB GROUP BY "userId";
DELETE FROM "MSTR_EMPLOYEE_T";
SELECT "countryOfBirth" AS "countryOfBirth", "firstName" AS "firstName", "lastName" AS "lastName", "gender" AS "gender", "startDate" AS "startDate", "endDate" AS "endDate", "employmentEndDate" AS "employmentEndDate", "employmentStartDate" AS "employmentStartDate", "userId" AS "userId", "employeeType" AS "employeeType", "employmentType" AS "employmentType", "holidayCalendarCode" AS "holidayCalendarCode", "jobCode" AS "jobCode", "jobTitle" AS "jobTitle", "managerId" AS "managerId", "position" AS "position", "positionEntryDate" AS "positionEntryDate", "regularTemp" AS "regularTemp", "workscheduleCode" AS "workscheduleCode", "email" AS "email", "matrixManagerUserId" AS "matrixManagerUserId", "employeeClass" AS "employeeClass", "standardJobCode" AS "standardJobCode", "subDepartment" AS "subDepartment", "emplStatus" AS "emplStatus", "location" AS "location", "standardHours" AS "standardHours", "workingDaysPerWeek" AS "workingDaysPerWeek", "division" AS "division", "isPrimary" AS "isPrimary", "isContingentWorker" AS "isContingentWorker", "personIdExternal" AS "personIdExternal", "seniorityDate" AS "seniorityDate", "isFulltimeEmployee" AS "isFulltimeEmployee", "retired" AS "retired", "workerCategory" AS "workerCategory", "occupationPercent" AS "occupationPercent", "personalDivision" AS "personalDivision", "hireDate" AS "hireDate" FROM :F_DISTINCT_F_DISTINCT_OUTPUT_TAB INTO "MSTR_EMPLOYEE_T";
JOIN_LATEST_JOIN_LATEST_OUTPUT_TAB = SELECT "JOIN_LATEST_F_DISTINCT"."countryOfBirth" AS "countryOfBirth", "JOIN_LATEST_F_DISTINCT"."firstName" AS "firstName", "JOIN_LATEST_F_DISTINCT"."lastName" AS "lastName", "JOIN_LATEST_F_DISTINCT"."gender" AS "gender", "JOIN_LATEST_F_DISTINCT"."startDate" AS "startDate", "JOIN_LATEST_F_DISTINCT"."endDate" AS "endDate", "JOIN_LATEST_F_DISTINCT"."employmentEndDate" AS "employmentEndDate", "JOIN_LATEST_F_DISTINCT"."employmentStartDate" AS "employmentStartDate", "JOIN_LATEST_F_DISTINCT"."userId" AS "userId", "JOIN_LATEST_F_DISTINCT"."employeeType" AS "employeeType", "JOIN_LATEST_F_DISTINCT"."employmentType" AS "employmentType", "JOIN_LATEST_F_DISTINCT"."holidayCalendarCode" AS "holidayCalendarCode", "JOIN_LATEST_F_DISTINCT"."jobCode" AS "jobCode", "JOIN_LATEST_F_DISTINCT"."jobTitle" AS "jobTitle", "JOIN_LATEST_F_DISTINCT"."managerId" AS "managerId", "JOIN_LATEST_F_DISTINCT"."position" AS "position", "JOIN_LATEST_F_DISTINCT"."positionEntryDate" AS "positionEntryDate", "JOIN_LATEST_F_DISTINCT"."regularTemp" AS "regularTemp", "JOIN_LATEST_F_DISTINCT"."workscheduleCode" AS "workscheduleCode", "JOIN_LATEST_F_DISTINCT"."email" AS "email", "JOIN_LATEST_F_DISTINCT"."matrixManagerUserId" AS "matrixManagerUserId", "JOIN_LATEST_F_DISTINCT"."employeeClass" AS "employeeClass", "JOIN_LATEST_F_DISTINCT"."standardJobCode" AS "standardJobCode", "JOIN_LATEST_F_DISTINCT"."subDepartment" AS "subDepartment", "JOIN_LATEST_F_DISTINCT"."emplStatus" AS "emplStatus", "JOIN_LATEST_F_DISTINCT"."location" AS "location", "JOIN_LATEST_F_DISTINCT"."standardHours" AS "standardHours", "JOIN_LATEST_F_DISTINCT"."workingDaysPerWeek" AS "workingDaysPerWeek", "JOIN_LATEST_F_DISTINCT"."division" AS "division", "JOIN_LATEST_F_DISTINCT"."isPrimary" AS "isPrimary", "JOIN_LATEST_F_DISTINCT"."isContingentWorker" AS "isContingentWorker", "JOIN_LATEST_F_DISTINCT"."personIdExternal" AS "personIdExternal", "JOIN_LATEST_F_DISTINCT"."seniorityDate" AS "seniorityDate", "JOIN_LATEST_F_DISTINCT"."hireDate" AS "hireDate", "JOIN_LATEST_AGG_LASTEST"."startDate" AS "latestDate" FROM (:F_DISTINCT_F_DISTINCT_OUTPUT_TAB AS "JOIN_LATEST_F_DISTINCT" INNER JOIN :AGG_LATEST_AGG_LATEST_OUTPUT_TAB AS "JOIN_LATEST_AGG_LASTEST" ON "JOIN_LATEST_AGG_LASTEST"."userId" = "JOIN_LATEST_F_DISTINCT"."userId");
F_FLAG_LATEST_F_FLAG_LATEST_OUTPUT_TAB=SELECT "countryOfBirth", "firstName", "lastName", "gender", "startDate", "endDate", "employmentEndDate", "employmentStartDate", "userId", "employeeType", "employmentType", "holidayCalendarCode", "jobCode", "jobTitle", "F_FLAG_LATEST_Input"."managerId" AS "managerId", "position", "positionEntryDate", "regularTemp", "workscheduleCode", "email", "matrixManagerUserId", "employeeClass", "standardJobCode", "subDepartment", "emplStatus", "location", "standardHours", "workingDaysPerWeek", "division", "isPrimary", "isContingentWorker", "personIdExternal", "F_FLAG_LATEST_Input"."seniorityDate" AS "seniorityDate", CASE WHEN "F_FLAG_LATEST_Input"."startDate" = "F_FLAG_LATEST_Input"."latestDate" THEN 1 ELSE 0 END AS "isLatestVersion", "hireDate" FROM :JOIN_LATEST_JOIN_LATEST_OUTPUT_TAB AS "F_FLAG_LATEST_Input" WHERE UPPER( "F_FLAG_LATEST_Input"."firstName" ) NOT LIKE '%DUMMY%';
DELETE FROM "MSTR_EMPLOYEE";
SELECT "countryOfBirth" AS "countryOfBirth", "firstName" AS "firstName", "lastName" AS "lastName", "gender" AS "gender", "startDate" AS "startDate", "endDate" AS "endDate", "employmentEndDate" AS "employmentEndDate", "employmentStartDate" AS "employmentStartDate", "userId" AS "userId", "employeeType" AS "employeeType", "employmentType" AS "employmentType", "holidayCalendarCode" AS "holidayCalendarCode", "jobCode" AS "jobCode", "jobTitle" AS "jobTitle", "managerId" AS "managerId", "position" AS "position", "positionEntryDate" AS "positionEntryDate", "regularTemp" AS "regularTemp", "workscheduleCode" AS "workscheduleCode", "email" AS "email", "matrixManagerUserId" AS "matrixManagerUserId", "employeeClass" AS "employeeClass", "standardJobCode" AS "standardJobCode", "subDepartment" AS "subDepartment", "emplStatus" AS "emplStatus", "location" AS "location", "standardHours" AS "standardHours", "workingDaysPerWeek" AS "workingDaysPerWeek", "division" AS "division", "isPrimary" AS "isPrimary", "isContingentWorker" AS "isContingentWorker", "personIdExternal" AS "personIdExternal", "seniorityDate" AS "seniorityDate", "isLatestVersion" AS "isLatestVersion", "hireDate" AS "hireDate" FROM :F_FLAG_LATEST_F_FLAG_LATEST_OUTPUT_TAB INTO "MSTR_EMPLOYEE";
END
